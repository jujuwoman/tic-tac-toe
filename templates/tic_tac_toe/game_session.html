<!–- base template -–>
{% extends "tic_tac_toe/base.html" %}
{% load static %}


<!–- prompt message -–>
{% block message %}
    {% include "tic_tac_toe/prompt.html" %}
{% endblock %}


<!–- grid where player makes move -–>
{% block grid %}
    {% include "tic_tac_toe/grid_active.html" %}


    <script>
        {# must match constant in config.py #}
        const DEFAULT_COMPUTER_NAME = "Computer";

        // Simulate click function
        function click_cell(cell_id) {
            document.querySelector(cell_id).click();
        }







        {# used by makeMoveViaAjax #}
        function makeMark(mark, cell_id) {
            let html = '<div id=mark></div>';
            document.getElementById(cell_id).outerHTML = html.replace("mark", mark);
        }

        {# used by makeMoveViaAjax #}
        function makePrompt(mark, name) {
            let html = '<span id=mark></span>';
            document.getElementById("prompt_name").innerHTML = name;
            document.getElementById("prompt_mark").innerHTML = html.replace("mark", mark);
        }

        {# used by makeMoveViaAjax #}
{#        function isComputer(name) {#}
{#            if (name === DEFAULT_COMPUTER_NAME) {#}
{#                let html = "test";#}
{#            }#}
{#        }#}

        {# handles player's move #}
        function makeMoveViaAjax(cell_id) {
            $.ajax({
                type: "POST",
                url: "{% url 'make_move_via_ajax' %}",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                data: {
                    "cell_id": cell_id
                },
                dataType: 'json',
                success: function (data) {
                    makeMark(data.current_player["mark"], cell_id);

                    if (data.result) {
                        window.location.href = "{% url 'game_over' %}";
                    } else {
                        makePrompt(data.next_player["mark"], data.next_player["name"]);

                        {#if (data.next_player["name"] == "Computer") {#}
                        {#    makeMoveViaAjax()#}
                        {#}#}

                        {#if (data.is_computer, or rahter whehter nxt player is computer) {#}
                            {#timedelay? mebbe in python#}
                        {#    makeMark(computer_mark, computer_move_cell_id)#}
                        {#}#}
                        {#OR!!;#}
                        {#ask computer ot make ajax call#}




                    }
                },
                error: function (data) {
                    alert("Error response :\n" + data);
                }
            });
        }
    </script>
{% endblock %}


<!–- legend that shows which player uses which symbol -–>
{% block legend %}
    {% include 'tic_tac_toe/legend.html' %}
{% endblock %}